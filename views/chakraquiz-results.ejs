<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Energy Leak Results</title>
  <link rel="stylesheet" href="/css/chakraquiz-results.css">
</head>
<body>
    <main class="wrap">

        <div class="page-topbar">
            <h1>Energy Leak Results</h1>

            <!--Back Button-->
            <a class="btn back-page-action" href="/clientmanagement">Back to Client Management</a>
        </div>
     
        <!--Total Sumbissions-->
        <section class="stats">
            <div class="card">
                <h3>Total Submissions</h3>
                <p class="stat"><%= stats.total %></p>
            </div>
        </section>


        <!-- Filters -->
        <form id="filters" class="filters" method="get" action="/clientmanagement/chakraquiz-results">
        <div class="field">
            <label for="q">Search</label>
            <input id="q" name="q" value="<%= q %>" placeholder="Name, email, phone, job title…">
        </div>

        <!-- Age Bracket Filter -->
        <div class="field">
            <label for="ageBracket">Age Bracket</label>
            <select id="ageBracket" name="ageBracket">
            <option value="">Any</option>
            <option <%= ageBracket==='20-30'?'selected':'' %>>20-30</option>
            <option <%= ageBracket==='30-40'?'selected':'' %>>30-40</option>
            <option <%= ageBracket==='40-50'?'selected':'' %>>40-50</option>
            <option <%= ageBracket==='50+'?'selected':'' %>>50+</option>
            </select>
        </div>

        <!-- Healthcare Worker -->
        <div class="field">
            <label for="healthcareWorker">Healthcare Worker</label>
            <select id="healthcareWorker" name="healthcareWorker">
            <option value="">Any</option>
            <option value="yes" <%= healthcareWorker==='yes'?'selected':'' %>>Yes</option>
            <option value="no"  <%= healthcareWorker==='no'?'selected':'' %>>No</option>
            </select>
        </div>

        <!-- Experience -->
        <div class="field">
            <label for="experience">Worked With Practitioner</label>
            <select id="experience" name="experience">
            <option value="">Any</option>
            <option value="current"  <%= experience==='current'  ?'selected':'' %>>Currently working with one</option>
            <option value="past"     <%= experience==='past'     ?'selected':'' %>>In the past</option>
            <option value="no"       <%= experience==='no'       ?'selected':'' %>>First time</option>
            <option value="notSure"  <%= experience==='notSure'  ?'selected':'' %>>Not sure</option>
            <option value="other"    <%= experience==='other'    ?'selected':'' %>>Other</option>
            </select>
        </div>

        <!-- Familiar With -->
        <div class="field">
            <label>Familiar With</label>
            <div class="checkbx">
            <%
                const famSel = familiarWith || [];
                const FAM_MAP = {
                kundalini: 'Kundalini Yoga',
                soundBaths: 'Sound Baths',
                lifeCoaching: 'Life Coaching',
                eft: 'Emotional Freedom Technique',
                none: 'None of the above'
                };
                Object.entries(FAM_MAP).forEach(([slug,label]) => { %>
                <label class="cb">
                    <input type="checkbox" name="familiarWith" value="<%= slug %>" <%= famSel.includes(slug)?'checked':'' %> />
                    <span><%= label %></span>
                </label>
            <% }); %>
            </div>
        </div>

        <!-- Challenges -->
        <div class="field">
            <label>Challenges</label>
            <div class="checkbx">
            <%
                const chSel = challenges || [];
                const CHALLENGE_MAP = {
                physical: 'Physical (fatigue, pain, chronic issues)',
                emotional: 'Emotional (stress, anxiety, overwhelm)',
                mental: 'Mental (overthinking, lack of focus, burnout)',
                spiritual: 'Spiritual (disconnection, lack of clarity, seeking purpose)',
                other: 'Other'
                };
                Object.entries(CHALLENGE_MAP).forEach(([slug, label]) => { %>
                <label class="cb">
                    <input type="checkbox" name="challenges" value="<%= slug %>" <%= chSel.includes(slug) ? 'checked' : '' %> />
                    <span><%= label %></span>
                </label>
            <% }); %>
            </div>
        </div>

        <!-- Focus Chakra -->
        <div class="field">
            <label>Focus Chakra</label>
            <div class="checkbx">
            <% const fc = focusChakra || []; %>
            <% ['rootChakra','sacralChakra','solarPlexusChakra','heartChakra','throatChakra','thirdEyeChakra','crownChakra'].forEach(opt => { %>
                <label class="cb">
                <input type="checkbox" name="focusChakra" value="<%= opt %>" <%= fc.includes(opt)?'checked':'' %> />
                <span><%= opt %></span>
                </label>
            <% }) %>
            </div>
        </div>

        <!-- Archetype -->
        <div class="field">
            <label>Archetype</label>
            <div class="checkbx">
            <% const arch = archetype || []; %>
            <% ['workerBee','martyr','innerChild','saboteur','lover','caretaker','rebel', 'creatorVisionary', 'ruler'].forEach(opt => { %>
                <label class="cb">
                <input type="checkbox" name="archetype" value="<%= opt %>" <%= arch.includes(opt)?'checked':'' %> />
                <span><%= opt %></span>
                </label>
            <% }) %>
            </div>
        </div>

        <!-- Dates -->
        <div class="field">
            <label for="from">From</label>
            <input type="date" id="from" name="from" value="<%= from %>">
        </div>
        <div class="field">
            <label for="to">To</label>
            <input type="date" id="to" name="to" value="<%= to %>">
        </div>

        <div class="actions">
            <button class="btn" type="submit">Apply</button>
            <a class="btn ghost" href="/clientmanagement/chakraquiz-results">Reset</a>
        </div>
        </form>


            <!-- Table -->
        <section class="card">
            <form id="bulkDeleteForm" method="post" action="/clientmanagement/chakraquiz-results/bulk-delete">
            <div class="actions right">
                <button id="deleteBtn" class="btn delete" type="submit" disabled>Delete Selected</button>
            </div>
            
            <div class="table-wrap">
                <table id="results">
                    <thead>
                        <tr>
                        <th class="select">
                            <label for="selectAll" class="sellect-all">
                                Select All<br>
                                <input type="checkbox" id="selectAll"> 
                            </label>
                        </th>
                        <th>Date</th>
                        <th>Full Name</th>
                        <th>Email</th>
                        <th>Contact #</th>
                        <th>Age</th>
                        <th>HC Worker</th>
                        <th>Years</th>
                        <th>Job Title</th>
                        <th>Practitioner</th>
                        <th>Familiar With</th>
                        <th>Challenges</th>
                        <th>Goals</th>
                        <th>Experience</th>
                        <th>Focus Chakra</th>
                        <th>Archetype</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (rows.length === 0) { %>
                        <tr><td colspan="14" class="empty">No submissions match your filters.</td></tr>
                        <% } %>
                        <% rows.forEach(r => { %>
                        <tr>
                            <td class="select">
                                <input type="checkbox" name="ids[]" value="<%= r._id %>" aria-label="Select row for <%= r.fullName %>">
                            </td>
                            <td><%= new Date(r.createdAt).toLocaleDateString() %></td>
                            <td><%= r.fullName %></td>
                            <td><%= r.email %></td>
                            <td><%= r.contactNumber %></td>
                            <td><%= r.ageBracket %></td>
                            <td><%= r.healthcareWorker %></td>
                            <td><%= (r.healthcareYears ?? '') === '' ? '—' : r.healthcareYears %></td>
                            <td><%= r.jobTitle %></td>
                            
                            <td>
                            <%
                                let exp = r.experience || '-';
                                if (/^Other:\s*/i.test(exp)) {
                                exp = exp.replace(/^Other:\s*/i, 'Other — ');
                                } else {
                                const EXP_LABEL = {
                                    current: 'Currently working with one',
                                    past: 'In the past',
                                    no: 'First time',
                                    notSure: 'Not sure'
                                };
                                exp = EXP_LABEL[exp] || exp;
                                }
                            %>
                            <%= exp %>
                            </td>
                            <% 
                            const FAM_MAP = {
                                kundalini: 'Kundalini Yoga',
                                soundBaths: 'Sound Baths',
                                lifeCoaching: 'Life Coaching',
                                eft: 'Emotional Freedom Technique',
                                none: 'None of the above'
                            };
                            %>
                            <td>
                            <%= (r.familiarWith || []).map(s => FAM_MAP[s] || s).join(', ') %>
                            </td>
                            <td>
                            <%
                                const CHALLENGE_LABELS = {
                                physical: 'Physical',
                                emotional: 'Emotional',
                                mental: 'Mental',
                                spiritual: 'Spiritual',
                                other: 'Other'
                                };

                                const challenges = r.challenges || [];
                                let displayChallenges = challenges
                                .map(ch => CHALLENGE_LABELS[ch] || ch) // map slug → label
                                .join(', ');

                                if (challenges.includes('other') && r.challengeOther) {
                                displayChallenges = displayChallenges.replace(
                                    'Other',
                                    `Other — ${r.challengeOther}`
                                );
                                }
                            %>
                            <%= displayChallenges || '—' %>
                            </td>                            
                            <td class="wrap"><%= r.goals %></td>
                            <td class="wrap"><%= r.experienceDetails %></td>



                            <!-- Focus Chakra & Archetype Results -->
                             <td> 
                                <span class="chakra">
                                    <%=(r.focusChakra || '-').replace(/Chakra$/,'') %>
                                </span>
                             </td>

                             <td>
                                <span class="arch">
                                    <%=r.archetype || '-' %>
                                </span>
                             </td>
                        </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
          </form>
        </section>
    </main>

    <script src="/js/chakraquiz-results.js" defer></script>
</body>
